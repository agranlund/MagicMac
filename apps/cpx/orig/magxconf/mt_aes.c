#include <tos.h>
#include <mt_aes.h>

typedef struct
{
	_WORD	control[5];
	_WORD	intin[AES_INTINMAX];
	_WORD	intout[AES_INTOUTMAX];
	void	*addrin[AES_ADDRINMAX];
	void	*addrout[AES_ADDROUTMAX];
} MT_PARMDATA;


void _aes_trap(MT_PARMDATA *aes_params, const _WORD *control, _WORD *global_aes);


static _WORD const aes_control_data[][4] = {
	{ 10, 0, 1, 0 }, /* 0 */
	{ 11, 2, 1, 1 }, /* 1 */
	{ 12, 2, 1, 1 }, /* 2 */
	{ 13, 0, 1, 1 }, /* 3 */
	{ 14, 2, 1, 1 }, /* 4 */
	{ 15, 1, 1, 1 }, /* 5 */
	{ 17, 0, 1, 0 }, /* 6 */
	{ 18, 0, 1, 0 }, /* 7 */
	{ 19, 0, 1, 0 }, /* 8 */
	{ 130, 1, 5, 0 }, /* 9 */
	{ 20, 0, 1, 0 }, /* 10 */
	{ 21, 3, 5, 0 }, /* 11 */
	{ 22, 5, 5, 0 }, /* 12 */
	{ 23, 0, 1, 1 }, /* 13 */
	{ 24, 2, 1, 0 }, /* 14 */
	{ 25, 16, 7, 1 }, /* 15 */
	{ 25, 16, 7, 1 }, /* 16 */
	{ 26, 2, 1, 0 }, /* 17 */
	{ 30, 1, 1, 1 }, /* 18 */
	{ 31, 2, 1, 1 }, /* 19 */
	{ 32, 2, 1, 1 }, /* 20 */
	{ 33, 2, 1, 1 }, /* 21 */
	{ 34, 1, 1, 2 }, /* 22 */
	{ 35, 1, 1, 1 }, /* 23 */
	{ 36, 1, 1, 0 }, /* 24 */
	{ 36, 2, 1, 2 }, /* 25 */
	{ 37, 2, 1, 0 }, /* 26 */
	{ 37, 2, 1, 2 }, /* 27 */
	{ 38, 3, 1, 1 }, /* 28 */
	{ 39, 1, 1, 1 }, /* 29 */
	{ 40, 2, 1, 1 }, /* 30 */
	{ 41, 1, 1, 1 }, /* 31 */
	{ 42, 6, 1, 1 }, /* 32 objc_draw */
	{ 43, 4, 1, 1 }, /* 33 */
	{ 44, 1, 3, 1 }, /* 34 objc_offset */
	{ 45, 2, 1, 1 }, /* 35 */
	{ 46, 4, 2, 1 }, /* 36 */
	{ 46, 4, 2, 2 }, /* 37 */
	{ 47, 8, 1, 1 }, /* 38 */
	{ 48, 4, 3, 0 }, /* 39 */
	{ 50, 1, 1, 1 }, /* 40 */
	{ 50, 1, 2, 3 }, /* 41 */
	{ 51, 9, 1, 0 }, /* 42 */
	{ 51, 9, 1, 2 }, /* 43 */
	{ 52, 1, 1, 1 }, /* 44 form_alert */
	{ 53, 1, 1, 0 }, /* 45 */
	{ 54, 0, 5, 1 }, /* 46 */
	{ 55, 3, 3, 1 }, /* 47 */
	{ 56, 2, 2, 1 }, /* 48 */
	{ 70, 4, 3, 0 }, /* 49 */
	{ 71, 8, 3, 0 }, /* 50 */
	{ 72, 6, 1, 0 }, /* 51 */
	{ 73, 8, 1, 0 }, /* 52 */
	{ 74, 8, 1, 0 }, /* 53 */
	{ 75, 4, 1, 1 }, /* 54 */
	{ 76, 3, 1, 1 }, /* 55 */
	{ 77, 0, 5, 0 }, /* 56 */
	{ 77, 0, 6, 0 }, /* 57 */
	{ 78, 1, 1, 1 }, /* 58 */
	{ 79, 0, 5, 0 }, /* 59 */
	{ 80, 0, 1, 1 }, /* 60 */
	{ 81, 0, 1, 1 }, /* 61 */
	{ 82, 0, 1, 0 }, /* 62 */
	{ 90, 0, 2, 2 }, /* 63 */
	{ 91, 0, 2, 3 }, /* 64 */
	{ 100, 5, 1, 0 }, /* 65 */
	{ 101, 5, 1, 0 }, /* 66 */
	{ 102, 1, 1, 0 }, /* 67 */
	{ 103, 1, 1, 0 }, /* 68 */
	{ 104, 2, 5, 0 }, /* 69 */
	{ 104, 2, 5, 0 }, /* 70 */
	{ 105, 6, 1, 0 }, /* 71 */
	{ 105, 4, 1, 0 }, /* 72 */
	{ 105, 6, 1, 0 }, /* 73 */
	{ 106, 2, 1, 0 }, /* 74 */
	{ 107, 1, 1, 0 }, /* 75 */
	{ 108, 6, 5, 0 }, /* 76 */
	{ 109, 0, 0, 0 }, /* 77 */
	{ 110, 0, 1, 1 }, /* 78 */
	{ 111, 0, 1, 0 }, /* 79 */
	{ 112, 2, 1, 0 }, /* 80 */
	{ 113, 2, 1, 1 }, /* 81 */
	{ 114, 1, 1, 1 }, /* 82 */
	{ 115, 0, 1, 1 }, /* 83 */
	{ 120, 0, 1, 2 }, /* 84 */
	{ 121, 3, 1, 2 }, /* 85 */
	{ 122, 1, 1, 1 }, /* 86 */
	{ 123, 1, 1, 1 }, /* 87 */
	{ 124, 0, 1, 1 }, /* 88 */
	{ 125, 0, 1, 2 }, /* 89 */
	{ 126, 0, 1, 2 }, /* 90 */
	{ 127, 0, 1, 2 }, /* 91 */
	{ 135, 2, 1, 1 }, /* 92 */
	{ 135, 6, 2, 3 }, /* 93 */
	{ 136, 2, 1, 1 }, /* 94 */
	{ 160, 2, 0, 4 }, /* 95 */
	{ 161, 4, 1, 3 }, /* 96 */
	{ 162, 0, 3, 1 }, /* 97 */
	{ 163, 0, 1, 1 }, /* 98 */
	{ 164, 1, 1, 3 }, /* 99 */
	{ 164, 1, 2, 1 }, /* 100 */
	{ 164, 1, 0, 1 }, /* 101 */
	{ 164, 1, 1, 1 }, /* 102 */
	{ 165, 2, 1, 1 }, /* 103 */
	{ 165, 1, 1, 2 }, /* 104 */
	{ 165, 1, 1, 2 }, /* 105 */
	{ 165, 2, 1, 4 }, /* 106 */
	{ 165, 1, 1, 4 }, /* 107 */
	{ 166, 0, 1, 2 }, /* 108 */
	{ 167, 2, 0, 2 }, /* 109 */
	{ 170, 8, 0, 8 }, /* 110 */
	{ 171, 0, 0, 2 }, /* 111 */
	{ 172, 1, 1, 1 }, /* 112 */
	{ 173, 0, 1, 1 }, /* 113 */
	{ 174, 1, 1, 1 }, /* 114 */
	{ 174, 1, 0, 1 }, /* 115 */
	{ 174, 1, 1, 1 }, /* 116 */
	{ 174, 1, 0, 1 }, /* 117 */
	{ 174, 1, 1, 1 }, /* 118 */
	{ 174, 1, 1, 1 }, /* 119 */
	{ 174, 1, 0, 1 }, /* 120 */
	{ 174, 2, 0, 1 }, /* 121 */
	{ 174, 1, 0, 1 }, /* 122 */
	{ 174, 1, 1, 2 }, /* 123 */
	{ 174, 1, 1, 1 }, /* 124 */
	{ 174, 1, 1, 1 }, /* 125 */
	{ 174, 1, 1, 1 }, /* 126 */
	{ 175, 2, 0, 2 }, /* 127 */
	{ 175, 1, 0, 2 }, /* 128 */
	{ 175, 1, 0, 1 }, /* 129 */
	{ 175, 1, 0, 1 }, /* 130 */
	{ 175, 2, 0, 3 }, /* 131 */
	{ 175, 2, 0, 2 }, /* 132 */
	{ 175, 2, 0, 1 }, /* 133 */
	{ 175, 2, 0, 3 }, /* 134 */
	{ 180, 4, 0, 4 }, /* 135 */
	{ 181, 1, 1, 1 }, /* 136 */
	{ 182, 9, 1, 1 }, /* 137 */
	{ 183, 0, 3, 1 }, /* 138 */
	{ 184, 3, 1, 1 }, /* 139 */
	{ 184, 4, 1, 1 }, /* 140 */
	{ 184, 3, 1, 4 }, /* 141 */
	{ 184, 3, 0, 1 }, /* 142 */
	{ 185, 1, 1, 2 }, /* 143 */
	{ 185, 1, 0, 1 }, /* 144 */
	{ 185, 8, 1, 1 }, /* 145 */
	{ 186, 0, 9, 2 }, /* 146 */
	{ 187, 7, 0, 1 }, /* 147 */
	{ 190, 6, 1, 6 }, /* 148 */
	{ 191, 0, 1, 1 }, /* 149 */
	{ 192, 0, 1, 2 }, /* 150 */
	{ 193, 0, 4, 4 }, /* 151 */
	{ 194, 4, 4, 6 }, /* 152 */
	{ 195, 2, 2, 0 }, /* 153 */
	{ 200, 1, 0, 0 }, /* 154 */
	{ 201, 0, 1, 1 }, /* 155 */
	{ 202, 3, 1, 3 }, /* 156 */
	{ 203, 0, 3, 1 }, /* 157 */
	{ 204, 0, 2, 0 }, /* 158 */
	{ 205, 1, 1, 2 }, /* 159 */
	{ 205, 1, 1, 1 }, /* 160 */
	{ 205, 1, 1, 3 }, /* 161 */
	{ 205, 1, 1, 2 }, /* 162 */
	{ 205, 1, 1, 1 }, /* 163 */
	{ 205, 1, 0, 1 }, /* 164 */
	{ 205, 1, 1, 1 }, /* 165 */
	{ 205, 1, 1, 2 }, /* 166 */
	{ 205, 1, 1, 2 }, /* 167 */
	{ 205, 1, 1, 2 }, /* 168 */
	{ 206, 0, 2, 3 }, /* 169 */
	{ 207, 1, 1, 3 }, /* 170 */
};



_WORD mt_objc_draw_grect(OBJECT *tree, _WORD start, _WORD depth, const GRECT *r, WORD *global_aes)
{
	MT_PARMDATA aes_params;
	
	aes_params.intin[0] = start;
	aes_params.intin[1] = depth;
	*(GRECT *)&aes_params.intin[2] = *r;
	aes_params.addrin[0] = tree;
	
	_aes_trap(&aes_params, aes_control_data[32], global_aes);
	return aes_params.intout[0];
}


_WORD mt_objc_offset(OBJECT *tree, _WORD object, _WORD *x, _WORD *y, _WORD *global_aes)
{
	MT_PARMDATA aes_params;
	
	aes_params.intin[0] = object;
	aes_params.addrin[0] = tree;
	
	_aes_trap(&aes_params, aes_control_data[34], global_aes);
	*x = aes_params.intout[1];
	*y = aes_params.intout[2];
	return aes_params.intout[0];
}


_WORD mt_form_alert(_WORD fo_adefbttn, const char *fo_astring, _WORD *global_aes)
{
	MT_PARMDATA aes_params;
	
	aes_params.intin[0] = fo_adefbttn;
	aes_params.addrin[0] = fo_astring;
	
	_aes_trap(&aes_params, aes_control_data[44], global_aes);
	return aes_params.intout[0];
}
